{% extends 'core/plantilla/app.html' %}
{% load static %}

{% block content %}
<div class="container mt-6">
    <h2 class="title is-3 has-text-primary mb-5">Detalle de Cuenta</h2>

    <div class="card mb-6">
        <div class="card-content">
            <div class="columns is-multiline">
                <div class="column is-half">
                    <p class="mb-3">
                        <span class="icon has-text-info"><i class="fas fa-truck"></i></span>
                        <strong>Proveedor:</strong> {{ cuenta.proveedor.nombre }}
                    </p>
                    <p class="mb-3">
                        <span class="icon has-text-info"><i class="fas fa-file-invoice"></i></span>
                        <strong>Tipo de Documento:</strong> {{ cuenta.tipo_documento.nombre }}
                    </p>
                    <p class="mb-3">
                        <span class="icon has-text-info"><i class="fas fa-hashtag"></i></span>
                        <strong>Número de Documento:</strong> {{ cuenta.nro_documento }}
                    </p>
                </div>
                <div class="column is-half">
                    <p class="mb-3">
                        <span class="icon has-text-info"><i class="fas fa-calendar-alt"></i></span>
                        <strong>Fecha de Emisión:</strong> {{ cuenta.fecha_emision }}
                    </p>
                    <p class="mb-3">
                        <span class="icon has-text-info"><i class="fas fa-calendar-check"></i></span>
                        <strong>Fecha de Vencimiento:</strong> {{ cuenta.fecha_vencimiento }}
                    </p>
                </div>
            </div>

            <hr>

            <div class="columns is-multiline has-text-centered">
                <div class="column is-one-third">
                    <p class="is-size-5 has-text-success mb-1">
                        <span class="icon"><i class="fas fa-money-bill-wave"></i></span>
                        <strong>Monto Total</strong>
                    </p>
                    <p class="is-size-4">S/ {{ cuenta.monto_total }}</p>
                </div>
                <div class="column is-one-third">
                    <p class="is-size-5 has-text-warning mb-1">
                        <span class="icon"><i class="fas fa-hand-holding-dollar"></i></span>
                        <strong>Monto Abonado</strong>
                    </p>
                    <p class="is-size-4">S/ {{ cuenta.monto_abonado }}</p>
                </div>
                <div class="column is-one-third">
                    <p class="is-size-5 has-text-danger mb-1">
                        <span class="icon"><i class="fas fa-wallet"></i></span>
                        <strong>Saldo Pendiente</strong>
                    </p>
                    <p class="is-size-4">S/ {{ cuenta.saldo_pendiente }}</p>
                </div>
            </div>

            <div class="mt-5">
                <p class="is-size-5">
                    <span class="icon"><i class="fas fa-info-circle"></i></span>
                    <strong>Estado:</strong>
                    {% if cuenta.estado == 1 %}
                        <span class="tag is-success is-medium ml-2">Activa</span>
                    {% elif cuenta.estado == 2 %}
                        <span class="tag is-light is-medium ml-2">Cancelada</span>
                    {% elif cuenta.estado == 3 %}
                        <span class="tag is-danger is-medium ml-2">Vencida</span>
                    {% else %}
                        <span class="tag is-dark is-medium ml-2">Desconocido</span>
                    {% endif %}
                </p>
            </div>
        </div>
    </div>

    <!-- Historial de Pagos -->
    <h3 class="title is-4 has-text-link mb-4">Historial de Pagos</h3>

    <!-- Filtros por fecha -->
    <form method="get" class="columns is-multiline is-vcentered mb-5">
        <div class="column is-4">
            <input type="date" name="desde" class="input" value="{{ desde }}" placeholder="Desde">
        </div>
        <div class="column is-4">
            <input type="date" name="hasta" class="input" value="{{ hasta }}" placeholder="Hasta">
        </div>
        <div class="column is-2">
            <button type="submit" class="button is-link is-fullwidth">
                <span class="icon"><i class="fas fa-filter"></i></span>
                <span>Filtrar</span>
            </button>
        </div>
        <div class="column is-2">
            <a href="{% url 'detalle_cuenta' cuenta.cuenta_id %}" class="button is-light is-fullwidth">
                <span class="icon"><i class="fas fa-eraser"></i></span>
                <span>Limpiar</span>
            </a>
        </div>
    </form>

    <div class="table-container">
        <table class="table is-fullwidth is-striped is-hoverable is-bordered">
            <thead>
                <tr>
                    <th>Fecha</th>
                    <th>Monto</th>
                </tr>
            </thead>
            <tbody>
                {% for pago in pagos %}
                <tr>
                    <td>{{ pago.fecha_pago }}</td>
                    <td>S/ {{ pago.monto_pagado }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="2" class="has-text-centered">No hay pagos registrados.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    {% if pagos.has_other_pages %}
    <nav class="pagination is-centered" role="navigation" aria-label="pagination">
        {% if pagos.has_previous %}
        <a class="pagination-previous" href="?page={{ pagos.previous_page_number }}{% if desde %}&desde={{ desde }}{% endif %}{% if hasta %}&hasta={{ hasta }}{% endif %}">Anterior</a>
        {% else %}
        <a class="pagination-previous" disabled>Anterior</a>
        {% endif %}

        {% if pagos.has_next %}
        <a class="pagination-next" href="?page={{ pagos.next_page_number }}{% if desde %}&desde={{ desde }}{% endif %}{% if hasta %}&hasta={{ hasta }}{% endif %}">Siguiente</a>
        {% else %}
        <a class="pagination-next" disabled>Siguiente</a>
        {% endif %}

        <ul class="pagination-list">
            {% for num in pagos.paginator.page_range %}
            <li>
                <a class="pagination-link {% if pagos.number == num %}is-current{% endif %}" href="?page={{ num }}{% if desde %}&desde={{ desde }}{% endif %}{% if hasta %}&hasta={{ hasta }}{% endif %}">
                    {{ num }}
                </a>
            </li>
            {% endfor %}
        </ul>
    </nav>
    {% endif %}

    <a href="{% url 'listar_cuentas' %}" class="button is-link mt-6">
        <span class="icon"><i class="fas fa-arrow-left"></i></span>
        <span>Volver al listado</span>
    </a>
</div>
{% endblock %}
